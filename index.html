<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
  />
  <link rel="stylesheet" href="style.css" />
  <title>Weather App</title>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"/>
</head>
<body>
  <nav class="navbar navbar-light bg-dark justify-content-center">
    <span class="navbar-brand mb-0 h1" style="color: white; font-size: 3vw;"> Weather Dashboard</span>
  </nav>
  <div class="container">
    <div class="row">
      <div class="col-3">
      <h4>Search for a city:</h4>
        <form class="form-inline">
            <input class="form-control" type="search" id="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0 fas fa-search" type="submit"></button>
        </form>
        <div id="searches">
        </div>
      </div>
      <div class="col-9 justify-content-center">
        <div id="today">
          <h2 id="cityName">City Name
          </h2>
          <h6 class="todayStats" id="todayTemp">Temperature:</h6>
          <h6 class="todayStats" id="todayHumid">Humidity:</h6>
          <h6 class="todayStats" id="todayWind">Wind Speed:</h6>
          <h6 class="todayStats" id="todayUV">UV Index: <span class="badge badge-secondary" id="UVrating"></span></h6>
        </div>
        <div id="forcasttext">
          <h2>5-Day Forcast:</h2>
        </div>
        <div class="container justify-content-center">
          <div class="card col-auto" style="width: 8.5rem;">
            <div class="card-body">
              <h5 id="onedaylater"></h5> 
            </div>
          </div>
        </div>
          <div class="card col-auto ml-4" style="width: 8.5rem;">
            <div class="card-body">
              <h5 id="twodaylater"></h5> 
            </div>
          </div>
          <div class="card col-auto ml-4" style="width: 8.5rem;">
            <div class="card-body">
              <h5 id="threedaylater"></h5> 
            </div>
        </div>
          <div class="card col-auto ml-4" style="width: 8.5rem;">
            <div class="card-body">
              <h5 id="fourdaylater"></h5> 
            </div>
          </div>
          <div class="card col-auto ml-4" style="width: 8.5rem;">
            <div class="card-body">
              <h5 id="fivedaylater"></h5> 
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>

  var today = moment().format('L');
  var oneDay = moment().add(1, 'day').format('L');
  var twoDay = moment().add(2, 'day').format('L');
  var threeDay = moment().add(3, 'day').format('L');
  var fourDay = moment().add(4, 'day').format('L');
  var fiveDay = moment().add(5, 'day').format('L');
  var searchedCity = []
  var citySearch = ""
  var lon = ""
  var lat = ""
  $("#onedaylater").text(oneDay)
  $("#twodaylater").text(twoDay)
  $("#threedaylater").text(threeDay)
  $("#fourdaylater").text(fourDay)
  $("#fivedaylater").text(fiveDay)

  
  function weatherSearch(event){
    event.preventDefault();
    citySearch = $(".form-control").val();
    searchedCity.push(citySearch)
    console.log(searchedCity)
    localStorage.setItem("Cities",searchedCity)
    var queryURL = "https://api.openweathermap.org/data/2.5/weather?q="+citySearch+"&appid=bd4e60e82b50ca8a0a79d3108bb6b609"
    $.ajax({
      url: queryURL,
      method: "GET"
    }).then(function(response){
      $("#cityName").text(response.name)
      weatherURL = "http://openweathermap.org/img/w/"+response.weather[0].icon+".png"
      var image = $("<img>").attr("src", weatherURL)
      $("#cityName").append(image)
      $("#todayTemp").text("Temperature: " + ((parseInt(response.main.temp)-273.15)*1.8+32).toFixed(0) + "°F/ " + (parseInt(response.main.temp)-273.15).toFixed(1) + "°C")
      $("#todayHumid").text("Humidity: " + (response.main.humidity))
      $("#todayWind").text("Windspeed: " + (response.wind.speed))
      lon = response.coord.lon;
      lat = response.coord.lat;
      getUV(lon,lat);
      five(lon,lat);
    })
  }


  function getUV(lon,lat){
    let UVquery = "http://api.openweathermap.org/data/2.5/uvi?appid=bd4e60e82b50ca8a0a79d3108bb6b609&lat=" + lat + "&lon=" + lon
    $.ajax({
      url: UVquery,
      method: "GET"
    }).then(function(response2){
      UVrating = response2.value
      $("#UVrating").text(UVrating)
      if(UVrating < 3){
        $("#UVrating").css("background-color", "green")
      }
      else if(UVrating < 6){
        $("#UVrating").css("background-color", "yellow")
      }
      else if(UVrating < 8){
        $("#UVrating").css("background-color", "orange")
      }
      else if(UVrating < 11){
        $("#UVrating").css("background-color", "red")
      }
      else{
        $("#UVrating").css("background-color", "violet")
      }
    })
  }

//   function five(lon,lat){
//     let fivedayQuery = "http://api.openweathermap.org/data/2.5/forecast?lat="+lat+"&lon="+lon+"&appid=bd4e60e82b50ca8a0a79d3108bb6b609"
//     console.log(fivedayQuery)
//     $.ajax({
//       url: fivedayQuery,
//       method: "GET",
//     }).then(function(response3){
//       console.log(response3)
//       var futureTime = response3.list[39].dt
//       console.log(futureTime)
//       var sec = new Date(futureTime*1000)
//       console.log("Array 39 time is" + sec)
//       var timezone = response3.city.timezone
//       console.log(timezone)
//       toTimeZone(sec, timezone)
//     })
//   }

  function toTimeZone(time, zone) {
    var format = 'YYYY/MM/DD HH:mm:ss ZZ';
    return moment(time, format).tz(zone).format(format);
  }

  $(".btn").on("click",weatherSearch)
  
  </script>
</body>
</html>